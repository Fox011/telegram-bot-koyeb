#!/bin/bash

echo "ðŸ”„ ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐº Telegram Ð±Ð¾Ñ‚Ð°..."

# ÐÐ°Ñ…Ð¾Ð´Ð¸Ð¼ PID Ð¿Ñ€Ð¾Ñ†ÐµÑÑÐ° Ð±Ð¾Ñ‚Ð°
BOT_PID=$(pgrep -f "python.*bot.py")

if [ ! -z "$BOT_PID" ]; then
    echo "ðŸ›‘ ÐžÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÑŽ Ð±Ð¾Ñ‚Ð° (PID: $BOT_PID)..."
    kill -TERM $BOT_PID
    sleep 3
    
    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ð»ÑÑ Ð»Ð¸ Ð¿Ñ€Ð¾Ñ†ÐµÑÑ
    if ps -p $BOT_PID > /dev/null 2>&1; then
        echo "âš ï¸  ÐŸÑ€Ð¾Ñ†ÐµÑÑ Ð½Ðµ Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ð»ÑÑ, Ð¿Ñ€Ð¸Ð½ÑƒÐ´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ðµ..."
        kill -KILL $BOT_PID
    fi
fi

echo "ðŸš€ Ð—Ð°Ð¿ÑƒÑÐº Ð½Ð¾Ð²Ð¾Ð³Ð¾ ÑÐºÐ·ÐµÐ¼Ð¿Ð»ÑÑ€Ð° Ð±Ð¾Ñ‚Ð°..."
nohup bash start.sh > bot.log 2>&1 &
echo "âœ… Ð‘Ð¾Ñ‚ Ð¿ÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑ‰ÐµÐ½. Ð›Ð¾Ð³Ð¸ Ð² bot.log"